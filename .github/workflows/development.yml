name: ğŸš€ Deploy Frontend to Server
on:
    push:
        branches:
            - main # ğŸ‘ˆ deploy only when pushing to main branch

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            # ğŸ§° Step 1: Checkout repository
            - name: ğŸ§¾ Checkout code
              uses: actions/checkout@v4

            # ğŸ§± Step 2: Build frontend (replace with your build command)
            - name: ğŸ—ï¸ Build project
              run: |
                  npm install
                  npm run build

            # ğŸ“¤ Step 3: Upload dist folder to your server
            - name: ğŸ“¦ Upload build files to server
              uses: appleboy/scp-action@master
              with:
                  host: ${{ secrets.PRODUCTION_SSH_HOST }}
                  username: ${{ secrets.PRODUCTION_SSH_USERNAME }}
                  password: ${{ secrets.PRODUCTION_SSH_PASSWORD }}
                  source: "dist/*"
                  target: "/mnt/volume_blr1_04/project/pms/frontend"
                  overwrite: true

            # âš™ï¸ Step 4: SSH into the server and do post-deploy tasks
            - name: ğŸš€ Run post-deploy commands
              uses: appleboy/ssh-action@master
              with:
                  host: ${{ secrets.PRODUCTION_SSH_HOST }}
                  username: ${{ secrets.PRODUCTION_SSH_USERNAME }}
                  password: ${{ secrets.PRODUCTION_SSH_PASSWORD }}
                  script: |
                      cd /mnt/volume_blr1_04/project/pms/frontend

                      echo "ğŸ§¹ Cleaning old cache files..."
                      rm -rf node_modules .cache || true

                      echo "âœ… Deployment complete! Files are already extracted and live."
